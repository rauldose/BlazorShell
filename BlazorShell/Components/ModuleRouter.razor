@page "/module/{**route}"
@using BlazorShell.Infrastructure.Services
@inject ModuleRouteProvider RouteProvider
@inject NavigationManager Navigation

<PageTitle>Module Page</PageTitle>

@if (_componentType != null)
{
    <DynamicComponent Type="_componentType" />
}
else
{
    <div class="alert alert-warning">
        <h4>Page Not Found</h4>
        <p>The requested module page could not be found: @Route</p>
        <a href="/" class="btn btn-primary">Go Home</a>
    </div>
}

@code {
    [Parameter] public string Route { get; set; } = string.Empty;

    private Type? _componentType;
    private string _fullRoute = string.Empty;

    protected override void OnParametersSet()
    {
        // Construct the full route
        _fullRoute = $"/{Route}";

        // Try to get the component type for this route
        _componentType = RouteProvider.GetComponentForRoute(_fullRoute);

        // If not found, try without leading slash
        if (_componentType == null)
        {
            _componentType = RouteProvider.GetComponentForRoute(Route);
        }

        StateHasChanged();
    }
}